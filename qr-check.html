

<!DOCTYPE html>
<html lang="ml">
<head>
<meta charset="UTF-8">
<title>QR Code Security Checker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/html5-qrcode"></script>
<meta name="google" content="notranslate">
<style>
body{
  background:#0f172a;
  color:white;
  font-family:'Noto Sans Malayalam',sans-serif;
  text-align:center;
  padding:20px;
}

/* ===== ALERT BLINK ===== */
body.alert{
  animation:blink 1s infinite;
}
@keyframes blink{
  0%{background:#ff0000}
  50%{background:#7a0000}
  100%{background:#ff0000}
}

/* ===== CHOICE ===== */
#choice{
  margin-top:70px;
}
.choice-btn{
  width:100%;
  max-width:320px;
  padding:15px;
  margin:12px auto;
  font-size:1.1rem;
  border:none;
  border-radius:12px;
  cursor:pointer;
  background:#2563eb;
  color:white;
}

/* ===== SCANNER ===== */
#scannerUI{display:none}

#reader{
  max-width:400px;
  margin:auto;
  border:2px solid #334155;
  border-radius:10px;
}

button{
  background:#2563eb;
  color:white;
  border:none;
  padding:10px 15px;
  border-radius:6px;
  margin:5px;
  cursor:pointer;
}

#result{
  background:#1e293b;
  padding:15px;
  border-radius:10px;
  margin-top:20px;
  word-break:break-word;
}

.danger{color:#ef4444}

/* ===== MODAL ===== */
.modal{
  position:fixed;
  inset:0;
  display:none;
  background:rgba(0,0,0,0.8);
  justify-content:center;
  align-items:center;
  z-index:9999;
}
.modal.active{display:flex}

.modal-box{
  background:white;
  color:black;
  padding:20px;
  width:90%;
  max-width:420px;
  border-radius:12px;
}
.modal-box h2{color:red}
.modal-box button{width:100%;margin-top:10px}

@media(max-width:480px){
  h1{font-size:1.5rem}
}
</style>
</head>

<body>

<h1>üì∑ QR Code Security Checker</h1>

<!-- ===== CHOICE SCREEN ===== -->
<div id="choice">
  <button class="choice-btn" onclick="useCamera()">üì∑ Use camera</button>
  <button class="choice-btn" onclick="useUpload()">üìÅ Upload from Device</button>
</div>

<!-- ===== SCANNER UI ===== -->
<div id="scannerUI">
  <div id="reader"></div>
  <div>
    <button id="startBtn">‚ñ∂Ô∏è Scan</button>
    <button id="flipBtn" disabled>üîÑ Camera</button>
    <button id="stopBtn">‚èπ Stop</button>
  </div>
  <input type="file" id="fileInput" accept="image/*" hidden>
</div>

<div id="result">You can find the QR information here...</div>

<!-- ===== ALERT MODAL ===== -->
<div class="modal" id="alertModal">
  <div class="modal-box">
    <h2>‚ö†Ô∏è Security Warning!</h2>
    <p id="alertType"></p>
    <p id="alertMsg"></p>
    <button id="verifyBtn" style="background:red;color:white">üîç Verify </button>
    <button onclick="closeAlert()">Close</button>
  </div>
</div>

<script>
const resultEl=document.getElementById("result");
const alertModal=document.getElementById("alertModal");
const alertType=document.getElementById("alertType");
const alertMsg=document.getElementById("alertMsg");
const verifyBtn=document.getElementById("verifyBtn");

let html5QrCode=new Html5Qrcode("reader");
let cameras=[],camIndex=0,scanning=false;

/* ===== ENTRY OPTIONS ===== */
function useCamera(){
  document.getElementById("choice").style.display="none";
  document.getElementById("scannerUI").style.display="block";
  initCamera();
}

function useUpload(){
  document.getElementById("choice").style.display="none";
  document.getElementById("scannerUI").style.display="block";
  document.getElementById("fileInput").click();
}

/* ===== SECURITY ALERT ===== */
function securityAlert(text){
  const l=text.toLowerCase();
  let t="",m="",danger=false;

  if(l.startsWith("upi://")){
    t="üí∏ UPI Payment";
    m="This is a QR code for payment. If you are unsure, do not proceed.";
    danger=true;
  }else if(l.match(/\.(apk|exe|zip|pdf|docx?)$/)){
    t="üìÅ File Download";
    m="This file may be dangerous.";
    danger=true;
  }else if(l.startsWith("http")){
    t="üåê Web Link";
    m="This File May Be Harmful.";
    danger=true;
  }

  if(danger){
    document.body.classList.add("alert");
    alertType.innerHTML="<strong>QR Type:</strong> "+t;
    alertMsg.innerText=m;
    verifyBtn.onclick=()=>window.open(
      "https://kavalkaran-english.onrender.com/spam-check?url="+
      encodeURIComponent(text),"_blank"
    );
    alertModal.classList.add("active");
  }
}

function closeAlert(){
  alertModal.classList.remove("active");
  document.body.classList.remove("alert");
}

function showResult(text){
  resultEl.innerHTML="<strong>QR Founded:</strong><br>"+text;
  securityAlert(text);
}

/* ===== CAMERA ===== */
async function initCamera(){
  try{
    cameras=await Html5Qrcode.getCameras();
    document.getElementById("flipBtn").disabled=cameras.length<=1;
  }catch{
    resultEl.innerHTML="<p class='danger'>Camera Is Not Available</p>";
  }
}

async function startScan(){
  if(scanning) return;
  scanning=true;
  await html5QrCode.start(
    {deviceId:cameras[camIndex].id},
    {fps:10,qrbox:250},
    txt=>{stopScan();showResult(txt);}
  );
}

async function stopScan(){
  if(!scanning) return;
  scanning=false;
  try{await html5QrCode.stop();}catch{}
}

/* ===== FILE UPLOAD (FIXED) ===== */
document.getElementById("fileInput").addEventListener("change",async e=>{
  const file=e.target.files[0];
  if(!file) return;

  resultEl.innerHTML="üîç QR Checking...";
  try{
    const tempQr=new Html5Qrcode("reader");
    const txt=await tempQr.scanFile(file,true);
    showResult(txt);
  }catch{
    resultEl.innerHTML="<p class='danger'>‚ùå QR not found. Please use a clear image.</p>";
  }finally{
    e.target.value="";
  }
});

document.getElementById("startBtn").onclick=startScan;
document.getElementById("stopBtn").onclick=stopScan;
document.getElementById("flipBtn").onclick=()=>{
  camIndex=(camIndex+1)%cameras.length;
  stopScan();startScan();
};
</script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement(
    {
      pageLanguage: 'ml',
      includedLanguages: 'en,hi,as,bn,brx,doi,gu,kn,ks,gom,mai,ml,mni,mr,ne,or,pa,sa,sat,sd,ta,te,ur',
      autoDisplay: false,
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    },
    'google_translate_element'
  );

  applyLangFromURL();
}

/* üìå Read ?lang=hi */
function applyLangFromURL() {
  const params = new URLSearchParams(window.location.search);
  const lang = params.get('lang');

  if (!lang) return;

  setTimeout(() => {
    const select = document.querySelector('.goog-te-combo');
    if (select) {
      select.value = lang;
      select.dispatchEvent(new Event('change'));
    }
  }, 1200);
}
</script>

<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<div id="google_translate_container"
     style="
       position: fixed;
       top: 14px;
       right: 14px;
       z-index: 9999;
       background: #1e293b;
       padding: 6px 10px;
       border-radius: 10px;
       box-shadow: 0 4px 12px rgba(0,0,0,.35);
     ">
  <div id="google_translate_element"></div>
</div>
</body>
</html>
