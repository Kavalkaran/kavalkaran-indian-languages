
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QR Code Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
    background: #0f172a;
    color: white;
    font-family: 'Noto Sans', sans-serif;
    padding: 20px;
    text-align: center;
}
h1 {
    font-size: 1.8rem;
    margin-bottom: 20px;
}
#reader {
    width: 100%;
    max-width: 400px;
    margin: 20px auto;
    border: 2px solid #334155;
    border-radius: 10px;
}
#controls {
    margin: 15px auto;
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
}
button {
    background: #2563eb;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 10px 15px;
    cursor: pointer;
    font-size: 1rem;
    transition: 0.2s;
}
button:hover {
    background: #1e40af;
}
#file-input {
    margin-top: 10px;
    padding: 8px;
    border-radius: 6px;
    background: #1e293b;
    color: white;
    border: none;
}
#result {
    background: #1e293b;
    padding: 15px;
    border-radius: 10px;
    margin-top: 20px;
    word-wrap: break-word;
}
.safe { color: #10b981; }
.danger { color: #ef4444; }
.warning { color: #facc15; }

.qr-type-box {
    background: #334155;
    padding: 10px;
    border-radius: 10px;
    margin-top: 10px;
    font-size: 1.1em;
    display: inline-block;
}

#progress {
    width: 100%;
    max-width: 400px;
    height: 6px;
    background: #1e293b;
    border-radius: 5px;
    margin: 15px auto;
    overflow: hidden;
}
#progress-bar {
    width: 0%;
    height: 100%;
    background: #3b82f6;
    animation: progress 2s infinite;
}
@keyframes progress {
    0% { width: 0%; }
    50% { width: 80%; }
    100% { width: 0%; }
}
</style>
</head>

<body>
<h1>üì∑ QR Code Scanner</h1>
<div id="reader"></div>

<div id="controls">
<button id="start-btn">‚ñ∂Ô∏è Start Scan</button>
<button id="flip-btn" disabled>üîÑ Switch Camera</button>
<button id="stop-btn" disabled>‚èπ Stop</button>
</div>

<input type="file" accept="image/*" id="file-input">

<div id="progress" style="display:none;">
    <div id="progress-bar"></div>
</div>

<div id="result">QR data will appear here...</div>

<script>
const resultEl = document.getElementById("result");
const startBtn = document.getElementById("start-btn");
const stopBtn = document.getElementById("stop-btn");
const flipBtn = document.getElementById("flip-btn");
const progressEl = document.getElementById("progress");

let html5QrCode;
let cameras = [];
let currentCameraIndex = 0;
let scanning = false;

function analyzeData(data) {
    const lower = data.toLowerCase();
    let type = "Unknown";

    if (lower.startsWith("http://") || lower.startsWith("https://")) {
        type = "üåê URL Link";
    } else if (lower.startsWith("upi://")) {
        type = "üí∏ Payment QR";
    } else if (lower.match(/\.(pdf|docx|zip|apk|exe)$/)) {
        type = "üìÅ File Download";
    } else if (lower.startsWith("mailto:")) {
        type = "üìß Email Link";
    } else if (lower.startsWith("tel:")) {
        type = "üìû Phone Number";
    } else {
        type = "üìù Text";
    }

    let warning = "";
    if (lower.includes('bit.ly') || lower.includes('tinyurl') || lower.includes('redirect')) {
        warning = '<p class="warning">‚ö†Ô∏è Shortened link ‚Äì Be careful.</p>';
    } else if (lower.match(/\.exe|\.apk|\.bat/)) {
        warning = '<p class="danger">üõë Dangerous file link!</p>';
    } else if (lower.startsWith('http://') || lower.startsWith('https://')) {
        warning = '<p class="safe">üîó Normal link ‚Äì Be cautious while visiting.</p>';
    } else {
        warning = '<p class="safe">‚úÖ Normal data.</p>';
    }

    return `<div class="qr-type-box"><strong>QR Code Type:</strong> ${type}</div>${warning}`;
}

function showResult(decodedText) {
    resultEl.innerHTML = `<strong>QR Found:</strong><br>${decodedText}<br>${analyzeData(decodedText)}`;
}

async function initCamera() {
    try {
        html5QrCode = new Html5Qrcode("reader");
        cameras = await Html5Qrcode.getCameras();
        if (cameras.length === 0) throw new Error("Camera not found");
        flipBtn.disabled = cameras.length <= 1;
    } catch (err) {
        resultEl.innerHTML = `<p class="danger">üò¢ Camera not found: ${err.message}</p>`;
    }
}

async function startScan() {
    if (scanning) return;
    scanning = true;
    progressEl.style.display = "block";
    startBtn.disabled = true;
    stopBtn.disabled = false;

    try {
        await html5QrCode.start(
            { deviceId: cameras[currentCameraIndex].id },
            { fps: 10, qrbox: 250 },
            decodedText => { stopScan(); showResult(decodedText); }
        );
    } catch (err) {
        resultEl.innerHTML = `<p class="danger">‚ö†Ô∏è Failed to start scanning</p>`;
        stopScan();
    }
}

async function stopScan() {
    if (!scanning) return;
    scanning = false;
    progressEl.style.display = "none";
    startBtn.disabled = false;
    stopBtn.disabled = true;

    try { await html5QrCode.stop(); } catch {}
}

async function flipCamera() {
    if (cameras.length <= 1) return;
    currentCameraIndex = (currentCameraIndex + 1) % cameras.length;
    stopScan();
    await startScan();
}

document.getElementById("file-input").addEventListener("change", async e => {
    const file = e.target.files[0];
    if (!file) return;
    progressEl.style.display = "block";

    try {
        const decodedText = await html5QrCode.scanFile(file, true);
        showResult(decodedText);
    } catch {
        resultEl.innerHTML = `<span class="danger">‚ö†Ô∏è Scan failed: No QR detected</span>`;
    } finally {
        progressEl.style.display = "none";
    }
});

startBtn.addEventListener("click", startScan);
stopBtn.addEventListener("click", stopScan);
flipBtn.addEventListener("click", flipCamera);

initCamera();
</script>
<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>
